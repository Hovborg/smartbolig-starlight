---
title: Smart Stemmestyring
description: Komplet guide til lokal stemmestyring med Home Assistant Assist - Piper, Whisper, Wyoming og voice satellites.
sidebar:
  badge:
    text: Guide
    variant: note
---

import { Card, CardGrid, Aside, Badge, Tabs, TabItem } from '@astrojs/starlight/components';
import FAQ from '../../../../components/FAQ.astro';
import HowTo from '../../../../components/HowTo.astro';

<HowTo
  name="Ops√¶t lokal stemmestyring"
  description="Guide til Home Assistant Assist med Piper, Whisper og ESP32 voice satellites"
  totalTime="PT60M"
  steps={[
    "Installer Whisper (tale-til-tekst)",
    "Installer Piper (tekst-til-tale)",
    "Konfigurer Assist pipeline",
    "Tilf√∏j voice satellite (valgfrit)",
    "Test og tilpas wake word"
  ]}
/>

<Badge text="Stemme" variant="tip" /> <Badge text="Lokal" variant="success" /> <Badge text="Privacy" variant="caution" />

Med **Home Assistant Assist** kan du styre dit smarte hjem med stemmen - **100% lokalt** uden cloud! Ingen data forlader dit hjem, og det virker selv n√•r internettet er nede.

<Aside type="tip" title="Anbefalinger 2025">
**Voice Satellites (hardware):**
- **M5Stack ATOM Echo** - Billigst (~100 kr), lille, god lyd
- **ESP32-S3-BOX-3** - Bedst display, touchscreen (~400 kr)
- **Home Assistant Voice PE** - Officiel HA hardware (~500 kr)

**Software Stack:**
- **Whisper** - Tale-til-tekst (OpenAI, lokal)
- **Piper** - Tekst-til-tale (lokal, hurtig)
- **openWakeWord** - Wake word detection

**Anbefaling:** Start med ATOM Echo + Whisper/Piper!
</Aside>

---

## üé§ Stemmestyring Oversigt

### Assist Pipeline Komponenter

| Komponent | Funktion | Lokale Muligheder |
|-----------|----------|-------------------|
| **Wake Word** | Lytter efter aktiveringsord | openWakeWord, microWakeWord |
| **STT** | Tale til tekst | Whisper, Speech-to-Phrase |
| **Intent** | Forst√•r kommandoer | HA Conversation, LLM |
| **TTS** | Tekst til tale | Piper, Home Assistant Cloud |
| **Satellite** | Mikrofon/h√∏jttaler | ESP32, Voice PE |

### Hardware Sammenligning

| Enhed | Pris | Display | Mikrofon | H√∏jttaler | Wake Word |
|-------|------|---------|----------|-----------|-----------|
| **ATOM Echo** | ~100 kr | ‚ùå | ‚úÖ | ‚úÖ (lille) | On-device |
| **S3-BOX-3** | ~400 kr | ‚úÖ Touch | ‚úÖ‚úÖ | ‚úÖ | On-device |
| **Voice PE** | ~500 kr | ‚úÖ | ‚úÖ‚úÖ | ‚úÖ‚úÖ | On-device |
| **CoreS3SE** | ~600 kr | ‚úÖ Touch | ‚úÖ‚úÖ | ‚úÖ | On-device |

---

## üîß Lokal Voice Setup

<Tabs>
  <TabItem label="1. Installer Add-ons">
    ### Whisper (Tale-til-Tekst)
    
    ```yaml
    # Indstillinger ‚Üí Add-ons ‚Üí Add-on Store
    # S√∏g "Whisper" ‚Üí Installer
    
    # Konfiguration (Settings tab):
    model: small  # tiny, base, small, medium, large
    language: da  # Dansk!
    
    # Start add-on
    # Vent p√• model download (kan tage tid)
    ```
    
    <Aside type="note">
    **Model st√∏rrelser:**
    - `tiny` - Hurtigst, lavest kvalitet
    - `small` - God balance (anbefalet)
    - `medium` - Bedre kvalitet, langsommere
    - `large` - Bedst kvalitet, kr√¶ver meget RAM
    </Aside>
    
    ### Piper (Tekst-til-Tale)
    
    ```yaml
    # Indstillinger ‚Üí Add-ons ‚Üí Add-on Store
    # S√∏g "Piper" ‚Üí Installer
    
    # Konfiguration:
    voice: da_DK-talesyntese-medium  # Dansk stemme
    
    # Start add-on
    ```
    
    ### openWakeWord (Wake Word)
    
    ```yaml
    # Indstillinger ‚Üí Add-ons ‚Üí Add-on Store
    # S√∏g "openWakeWord" ‚Üí Installer ‚Üí Start
    
    # Underst√∏ttede wake words:
    # - "Ok Nabu"
    # - "Hey Jarvis"
    # - "Alexa"
    # - "Hey Mycroft"
    ```
  </TabItem>
  <TabItem label="2. Wyoming Integration">
    ### Tilf√∏j Integrationer
    
    ```yaml
    # Indstillinger ‚Üí Enheder & Services ‚Üí Tilf√∏j Integration
    
    # 1. S√∏g "Wyoming Protocol"
    # - Whisper burde auto-discoveres
    # - Klik "Konfigurer" ‚Üí "Send"
    
    # 2. Piper burde ogs√• auto-discoveres
    # - Klik "Konfigurer" ‚Üí "Send"
    
    # 3. openWakeWord liges√•
    # - Klik "Konfigurer" ‚Üí "Send"
    ```
    
    <Aside type="tip">
    Hvis de ikke auto-discoveres, tilf√∏j manuelt:
    - Host: `core-whisper` / `core-piper` / `core-openwakeword`
    - Port: `10300` / `10200` / `10400`
    </Aside>
  </TabItem>
  <TabItem label="3. Assist Pipeline">
    ### Opret Voice Assistant
    
    ```yaml
    # Indstillinger ‚Üí Voice Assistants ‚Üí Tilf√∏j Assistant
    
    # Navn: "Dansk Assistent"
    # Sprog: Dansk
    
    # Conversation agent: Home Assistant
    # Speech-to-text: Whisper
    # Text-to-speech: Piper
    # Wake word: openWakeWord (v√¶lg wake word)
    
    # Gem
    ```
    
    ### Test Pipeline
    
    ```yaml
    # Klik p√• "Pr√∏v pipeline" knappen
    # Sig: "T√¶nd lyset i stuen"
    
    # Tjek:
    # - Blev talen genkendt korrekt?
    # - Blev kommandoen forst√•et?
    # - H√∏rte du svaret?
    ```
  </TabItem>
</Tabs>

---

## üì± Voice Satellites

<Tabs>
  <TabItem label="M5Stack ATOM Echo">
    **Pris:** ~$13 / ~100 kr
    
    **Den billigste voice satellite:**
    
    - ‚úÖ ESP32 baseret
    - ‚úÖ Indbygget mikrofon + h√∏jttaler
    - ‚úÖ On-device wake word (microWakeWord)
    - ‚úÖ LED status indikator
    - ‚úÖ Nem setup via web
    - ‚ö†Ô∏è Lille h√∏jttaler (lav lydstyrke)
    - ‚ùå Intet display
    
    ### Installation
    
    ```yaml
    # 1. G√• til: https://www.home-assistant.io/voice_control/thirteen-usd-voice-remote/
    # 2. Klik "Connect" i Chrome/Edge
    # 3. V√¶lg COM port
    # 4. Klik "Install Voice Assistant"
    # 5. Indtast WiFi credentials
    # 6. Enhed dukker op i HA
    ```
    
    ### ESPHome Config (avanceret)
    
    ```yaml
    substitutions:
      name: stue-voice
      friendly_name: "Stue Voice Assistant"
      micro_wake_word_model: hey_jarvis
    
    packages:
      m5stack.atom-echo:
        url: https://github.com/esphome/firmware
        files:
          - voice-assistant/m5stack-atom-echo.yaml
        refresh: 0s
    
    esphome:
      name: ${name}
      friendly_name: ${friendly_name}
    
    wifi:
      ssid: !secret wifi_ssid
      password: !secret wifi_password
    ```
    
    **K√∏b:** [M5Stack](https://shop.m5stack.com/products/atom-echo-smart-speaker-dev-kit), AliExpress
  </TabItem>
  <TabItem label="ESP32-S3-BOX-3">
    **Pris:** ~$50 / ~400 kr
    
    **Bedste all-round voice satellite:**
    
    - ‚úÖ 2.4" touchscreen display
    - ‚úÖ Dual mikrofoner (bedre genkendelse)
    - ‚úÖ God h√∏jttaler
    - ‚úÖ On-device wake word
    - ‚úÖ Officiel ESPHome support
    - ‚úÖ Inkluderer dock/stand
    - ‚ö†Ô∏è Kr√¶ver USB-C str√∏m
    
    ### Installation
    
    ```yaml
    # 1. ESPHome ‚Üí New Device
    # 2. Name: "bedroom-voice"
    # 3. Device: ESP32-S3-BOX-3
    # 4. Tilf√∏j til YAML:
    
    packages:
      esphome.voice-assistant:
        url: https://github.com/esphome/firmware
        files:
          - voice-assistant/esp32-s3-box-3.yaml
        refresh: 0s
    
    substitutions:
      micro_wake_word_model: okay_nabu
    
    esphome:
      name: bedroom-voice
      friendly_name: "Sovev√¶relse Voice"
    
    wifi:
      ssid: !secret wifi_ssid
      password: !secret wifi_password
    
    api:
      encryption:
        key: !secret api_key
    ```
    
    **K√∏b:** [Espressif](https://www.espressif.com), AliExpress, Amazon
  </TabItem>
  <TabItem label="Home Assistant Voice PE">
    **Pris:** ~$59 / ~500 kr
    
    **Officiel Home Assistant hardware:**
    
    - ‚úÖ Designet specifikt til HA
    - ‚úÖ Premium mikrofoner
    - ‚úÖ God h√∏jttaler
    - ‚úÖ E-ink display
    - ‚úÖ Fysisk mute knap
    - ‚úÖ Pre-installeret firmware
    - ‚úÖ Officiel support
    
    ### Setup
    
    ```yaml
    # 1. Tilslut USB-C str√∏m
    # 2. F√∏lg on-screen instruktioner
    # 3. Scan QR kode med HA app
    # 4. V√¶lg WiFi netv√¶rk
    # 5. Tildel til rum
    # 6. F√¶rdig!
    ```
    
    <Aside type="tip" title="Bedste brugeroplevelse">
    Voice PE er den nemmeste l√∏sning - plug and play!
    </Aside>
    
    **K√∏b:** [Home Assistant Store](https://www.home-assistant.io/voice-pe/)
  </TabItem>
</Tabs>

---

## üó£Ô∏è Wake Words

### Tilg√¶ngelige Wake Words

| Wake Word | Sprog | Model |
|-----------|-------|-------|
| "Ok Nabu" | Multi | openWakeWord, microWakeWord |
| "Hey Jarvis" | Engelsk | microWakeWord |
| "Alexa" | Multi | microWakeWord |
| "Hey Mycroft" | Engelsk | microWakeWord |

### Opret Custom Wake Word

```yaml
# 1. G√• til: https://www.home-assistant.io/voice_control/create_wake_word/

# 2. V√¶lg et unikt ord (3-4 stavelser)
# - Undg√• almindelige ord
# - Kun engelsk underst√∏ttet pt.

# 3. Generer tr√¶ningsdata med Piper
# 4. Tr√¶n model (kan tage flere fors√∏g)
# 5. Download og installer
```

---

## ü§ñ Automationer med Stemme

```yaml
automation:
  # Broadcast til alle h√∏jttalere
  - alias: "Stemme - Godmorgen Broadcast"
    trigger:
      - platform: time
        at: "07:00:00"
    condition:
      - condition: state
        entity_id: binary_sensor.workday
        state: "on"
    action:
      - service: tts.speak
        target:
          entity_id: tts.piper
        data:
          media_player_entity_id: 
            - media_player.stue_speaker
            - media_player.kokken_speaker
          message: >
            God morgen! Klokken er 7. 
            Temperaturen udenfor er {{ states('sensor.outdoor_temperature') }} grader.
            {% if states('sensor.rain_probability') | int > 50 %}
            Husk paraply - der er risiko for regn.
            {% endif %}

  # P√•mindelse via stemme
  - alias: "Stemme - Vaskemaskine F√¶rdig"
    trigger:
      - platform: state
        entity_id: binary_sensor.vaskemaskine_running
        to: "off"
    action:
      - service: tts.speak
        target:
          entity_id: tts.piper
        data:
          media_player_entity_id: media_player.kokken_speaker
          message: "Vaskemaskinen er f√¶rdig. Husk at t√∏mme den."

  # Velkomst n√•r man kommer hjem
  - alias: "Stemme - Velkomst Hjem"
    trigger:
      - platform: state
        entity_id: person.brian
        to: "home"
    action:
      - delay: "00:00:30"
      - service: tts.speak
        target:
          entity_id: tts.piper
        data:
          media_player_entity_id: media_player.entr√©_speaker
          message: >
            Velkommen hjem! 
            Der er {{ states('sensor.indoor_temperature') }} grader indenfor.
```

---

## üéØ Stemmekommandoer

### Underst√∏ttede Kommandoer

```yaml
# Lys
"T√¶nd lyset i stuen"
"Sluk alle lys"
"S√¶t lysstyrken i k√∏kkenet til 50 procent"
"Skift farven i sovev√¶relset til bl√•"

# Klima
"Hvad er temperaturen?"
"S√¶t termostaten til 21 grader"
"T√¶nd for varmen i badev√¶relset"

# Enheder
"T√¶nd fjernsynet"
"Start st√∏vsugeren"
"L√•s hovedd√∏ren"

# Information
"Hvad er vejret i dag?"
"Hvorn√•r g√•r solen ned?"
"Er der nogen hjemme?"

# Scener
"Aktiver filmaften"
"Godnat"
"Jeg forlader hjemmet"
```

### Tilpas S√¶tninger

```yaml
# configuration.yaml eller via UI

intent_script:
  CustomWelcome:
    speech:
      text: "Velkommen! Hvad kan jeg hj√¶lpe med?"

conversation:
  intents:
    CustomWelcome:
      - "hej [assistent]"
      - "goddag"
      - "hvad kan du"
```

---

## üìä Dashboard

```yaml
type: vertical-stack
cards:
  # Voice status
  - type: entities
    title: "üé§ Stemmestyring"
    entities:
      - entity: assist_satellite.stue_voice
        name: "Stue Satellite"
      - entity: assist_satellite.sovevaerelse_voice
        name: "Sovev√¶relse Satellite"
      - entity: binary_sensor.whisper_running
        name: "Whisper Status"
      - entity: binary_sensor.piper_running
        name: "Piper Status"

  # Test knap
  - type: button
    name: "Test Stemme"
    tap_action:
      action: call-service
      service: tts.speak
      target:
        entity_id: tts.piper
      data:
        media_player_entity_id: media_player.stue_speaker
        message: "Stemmestyring virker!"
```

---

## ‚ùì Ofte Stillede Sp√∏rgsm√•l

<FAQ questions={[
  {
    question: "Virker dansk stemmegenkendelse?",
    answer: "Ja! Whisper underst√∏tter dansk meget godt med 'small' eller st√∏rre model. Piper har ogs√• danske stemmer. S√¶t language til 'da' i Whisper konfiguration."
  },
  {
    question: "Hvor meget RAM kr√¶ver lokal stemme?",
    answer: "Whisper 'small' model bruger ca. 2GB RAM. 'Medium' bruger 5GB. Raspberry Pi 4 med 4GB kan k√∏re 'small'. For bedre performance anbefales en mini-PC eller dedikeret server."
  },
  {
    question: "Kan jeg bruge flere wake words?",
    answer: "Ja! Siden HA 2025.10 kan du have op til 2 wake words per satellite. Du kan f.eks. bruge 'Ok Nabu' til dansk og 'Hey Jarvis' til engelsk pipeline."
  },
  {
    question: "Hvorfor svarer assistenten p√• engelsk?",
    answer: "Tjek at Piper er sat til dansk stemme, og at din Assist pipeline har dansk som sprog. Whisper skal ogs√• have language: da i konfigurationen."
  },
  {
    question: "Hvad er forskellen p√• Whisper og Speech-to-Phrase?",
    answer: "Whisper er en generel tale-til-tekst model der forst√•r alt. Speech-to-Phrase er optimeret til smart home kommandoer og er hurtigere/lettere, men mere begr√¶nset."
  }
]} />

---

## üìö N√¶ste Skridt

<CardGrid>
  <Card title="ESP32 Projekter" icon="seti:arduino">
    Byg flere ESPHome enheder.
    
    [Se guide ‚Üí](/da/esp32/)
  </Card>
  <Card title="Automationer" icon="rocket">
    Avancerede automationer.
    
    [Se guide ‚Üí](/da/home-assistant/foerste-automation/)
  </Card>
</CardGrid>

---

*Sidst opdateret: December 2025*
