---
title: Home Assistant OS p√• Proxmox
description: Komplet guide til installation af Home Assistant OS i en VM p√• Proxmox VE. Den anbefalede metode for avancerede brugere.
sidebar:
  badge:
    text: Avanceret
    variant: caution
---

import { Steps, Aside, Tabs, TabItem, Card, CardGrid, Badge } from '@astrojs/starlight/components';

<Badge text="Avanceret" variant="caution" /> <Badge text="30 min" variant="note" /> <Badge text="Gratis" variant="success" />

Proxmox er en fantastisk platform til at k√∏re Home Assistant OS. Du f√•r fuld VM-isolation, snapshots, backup og mulighed for at k√∏re andre services p√• samme hardware.

![Proxmox + Home Assistant arkitektur](/images/guides/proxmox-installation/architecture.svg)

## ü§î Hvorfor Proxmox?

| Feature | Proxmox VM | Raspberry Pi | Docker |
|---------|------------|--------------|--------|
| Snapshots | ‚úÖ Et klik | ‚ùå Nej | ‚ùå Nej |
| Live backup | ‚úÖ Ja | ‚ö†Ô∏è Manuelt | ‚ö†Ô∏è Manuelt |
| Hardware passthrough | ‚úÖ USB, PCIe | ‚úÖ Direkte | ‚ö†Ô∏è Begr√¶nset |
| Ressource skalering | ‚úÖ Nemt | ‚ùå Fast hardware | ‚úÖ Ja |
| Andre VMs/containers | ‚úÖ Ubegr√¶nset | ‚ùå Nej | ‚úÖ Ja |
| Add-ons support | ‚úÖ Fuld | ‚úÖ Fuld | ‚ùå Separat |

<Aside type="tip" title="Anbefalet til">
- Dem der allerede har en Proxmox server
- Dem der vil k√∏re Home Assistant sammen med andre services
- Dem der √∏nsker enterprise-grade backup og restore
</Aside>

## üìã Foruds√¶tninger

- ‚úÖ Proxmox VE 8.x eller nyere installeret
- ‚úÖ Mindst 2 CPU kerner ledige
- ‚úÖ Mindst 4 GB RAM ledigt
- ‚úÖ Mindst 32 GB storage (SSD anbefales)
- ‚úÖ Adgang til Proxmox shell (SSH eller web console)

## üöÄ Metode 1: Community Helper Script (Anbefalet)

Den nemmeste metode bruger det officielle community script fra [community-scripts.github.io/ProxmoxVE](https://community-scripts.github.io/ProxmoxVE/).

<Aside type="note" title="Open Source">
Proxmox VE Helper Scripts er open source og vedligeholdes af community. Se [GitHub repository](https://github.com/community-scripts/ProxmoxVE) for alle tilg√¶ngelige scripts.
</Aside>

<Steps>
1. **Log ind p√• Proxmox shell**
   
   SSH til din Proxmox server eller brug Shell i web-interfacet:
   ```bash
   ssh root@DIN-PROXMOX-IP
   ```

2. **K√∏r installationsscriptet**
   
   ```bash
   bash -c "$(wget -qLO - https://github.com/community-scripts/ProxmoxVE/raw/main/vm/haos-vm.sh)"
   ```

3. **F√∏lg installationsguiden**
   
   Scriptet vil sp√∏rge om:
   - **VM ID**: V√¶lg et ledigt nummer (f.eks. `100`)
   - **Machine Type**: V√¶lg `q35` (moderne, bedre performance)
   - **BIOS**: V√¶lg `OVMF (UEFI)` - p√•kr√¶vet for HAOS
   - **Disk st√∏rrelse**: Minimum `32GB`, anbefalet `64GB+`
   - **CPU kerner**: Minimum `2`, anbefalet `4`
   - **RAM**: Minimum `4096MB`, anbefalet `4096-8192MB`
   - **Bridge**: Dit netv√¶rksbridge (typisk `vmbr0`)
   - **MAC adresse**: Accepter auto-genereret
   - **VLAN**: Lad v√¶re tom medmindre du bruger VLAN
   - **Start efter oprettelse**: `Yes`

4. **Vent p√• installation**
   
   Scriptet downloader HAOS image og opretter VM'en. Dette tager 2-5 minutter.

5. **Find IP-adressen**
   
   N√•r VM'en er startet, find IP via:
   ```bash
   # I Proxmox shell
   qm guest cmd VMID network-get-interfaces
   ```
   Eller tjek din router's DHCP-liste.
</Steps>

<Aside type="note" title="Script features">
Scriptet konfigurerer automatisk:
- UEFI boot med EFI disk
- VirtIO SCSI controller (bedste performance)
- CPU type `host` (fuld CPU feature support)
- QEMU Guest Agent
- Optimal disk cache settings
</Aside>

## üîß Metode 2: Manuel installation

Hvis du foretr√¶kker fuld kontrol, kan du installere manuelt.

### Download HAOS image

<Steps>
1. **Find seneste version**
   
   G√• til [Home Assistant OS releases](https://github.com/home-assistant/operating-system/releases) og find den seneste `qcow2` fil for KVM/Proxmox.

2. **Download til Proxmox**
   
   ```bash
   # SSH til Proxmox
   cd /var/lib/vz/template/iso/
   
   # Download seneste HAOS (erstat VERSION med aktuel)
   wget https://github.com/home-assistant/operating-system/releases/download/VERSION/haos_ova-VERSION.qcow2.xz
   
   # Udpak
   xz -d haos_ova-VERSION.qcow2.xz
   ```
</Steps>

### Opret VM manuelt

<Steps>
1. **Opret VM uden disk**
   
   ```bash
   # Erstat VMID med dit √∏nskede ID (f.eks. 100)
   qm create VMID \
     --name haos \
     --memory 4096 \
     --cores 2 \
     --cpu host \
     --bios ovmf \
     --machine q35 \
     --net0 virtio,bridge=vmbr0 \
     --ostype l26 \
     --agent 1 \
     --onboot 1
   ```

2. **Tilf√∏j EFI disk**
   
   ```bash
   qm set VMID --efidisk0 local-lvm:1,efitype=4m
   ```

3. **Import√©r HAOS disk**
   
   ```bash
   # Import√©r qcow2 til VM
   qm importdisk VMID /var/lib/vz/template/iso/haos_ova-VERSION.qcow2 local-lvm
   
   # Tilknyt disk til VM
   qm set VMID --scsi0 local-lvm:vm-VMID-disk-1,cache=writethrough,discard=on,ssd=1
   
   # S√¶t boot order
   qm set VMID --boot order=scsi0
   ```

4. **Start VM**
   
   ```bash
   qm start VMID
   ```
</Steps>

## ‚öôÔ∏è Anbefalede VM-indstillinger

### Optimal konfiguration

| Indstilling | V√¶rdi | Forklaring |
|-------------|-------|------------|
| **Machine** | `q35` | Moderne chipset, bedre USB/PCIe |
| **BIOS** | `OVMF (UEFI)` | P√•kr√¶vet for HAOS |
| **CPU Type** | `host` | Fuld CPU support |
| **CPU Cores** | `2-4` | 2 minimum, 4 anbefalet |
| **RAM** | `4096-8192 MB` | 4GB minimum |
| **SCSI Controller** | `VirtIO SCSI` | Bedste disk performance |
| **Disk Cache** | `Write through` | Sikker, god performance |
| **Network** | `VirtIO` | Bedste netv√¶rks performance |
| **QEMU Agent** | `Enabled` | Snapshots, IP visning |

### Eksempel konfigurationsfil

```ini title="/etc/pve/qemu-server/VMID.conf"
agent: 1
bios: ovmf
boot: order=scsi0
cores: 4
cpu: host
efidisk0: local-lvm:vm-VMID-disk-0,efitype=4m,size=4M
machine: q35
memory: 4096
name: haos
net0: virtio=XX:XX:XX:XX:XX:XX,bridge=vmbr0
onboot: 1
ostype: l26
scsi0: local-lvm:vm-VMID-disk-1,cache=writethrough,discard=on,size=32G,ssd=1
scsihw: virtio-scsi-pci
```

## üîå USB Passthrough (Zigbee/Z-Wave)

For at bruge USB-enheder (Zigbee coordinator, Z-Wave stick) i Home Assistant:

<Steps>
1. **Find USB device ID**
   
   ```bash
   # P√• Proxmox host
   lsusb
   ```
   
   Output eksempel:
   ```
   Bus 002 Device 003: ID 1a86:55d4 QinHeng Electronics SONOFF Zigbee 3.0 USB Dongle Plus V2
   ```

2. **Tilf√∏j til VM**
   
   ```bash
   # Format: vendor:product (fra lsusb output)
   qm set VMID --usb0 host=1a86:55d4
   ```
   
   Eller via web-interface:
   - V√¶lg VM ‚Üí **Hardware** ‚Üí **Add** ‚Üí **USB Device**
   - V√¶lg **Use USB Vendor/Device ID**
   - V√¶lg din enhed fra listen

3. **Genstart VM**
   
   ```bash
   qm reboot VMID
   ```
</Steps>

<Aside type="caution" title="USB Passthrough tip">
Brug **Vendor/Device ID** i stedet for **USB Port**. S√• virker det selvom du s√¶tter USB-enheden i en anden port.
</Aside>

## üíæ Udvid disk st√∏rrelse

Hvis du l√∏ber t√∏r for plads:

<Steps>
1. **Udvid i Proxmox**
   
   Via CLI:
   ```bash
   qm resize VMID scsi0 +50G
   ```
   
   Eller via web-interface:
   - VM ‚Üí **Hardware** ‚Üí V√¶lg disk ‚Üí **Resize**

2. **Udvid i Home Assistant**
   
   HAOS udvider automatisk ved n√¶ste genstart, eller:
   - **Settings** ‚Üí **System** ‚Üí **Storage** ‚Üí **Resize**
</Steps>

## üì∏ Backup og Snapshots

### Snapshots (hurtige)

Perfekt f√∏r opdateringer eller eksperimenter:

```bash
# Opret snapshot
qm snapshot VMID pre-upgrade --vmstate 1

# Gendan snapshot
qm rollback VMID pre-upgrade

# Slet snapshot
qm delsnapshot VMID pre-upgrade
```

<Aside type="tip" title="Snapshot best practice">
Tag altid et snapshot F√òR st√∏rre Home Assistant opdateringer. Navngiv det beskrivende, f.eks. `pre-2024.12-upgrade`.
</Aside>

### Backup (fulde)

For disaster recovery:

```bash
# Manuel backup
vzdump VMID --compress zstd --storage local --mode snapshot

# Se backups
ls /var/lib/vz/dump/
```

Eller s√¶t automatisk backup op via **Datacenter** ‚Üí **Backup** i web-interfacet.

## üåê F√∏rste ops√¶tning

<Steps>
1. **√Öbn Home Assistant**
   
   G√• til `http://HAOS-IP:8123` i din browser.
   
   <Aside type="note">
   F√∏rste opstart tager 5-20 minutter. Du ser "Preparing Home Assistant" indtil det er klar.
   </Aside>

2. **Opret bruger**
   
   - V√¶lg brugernavn og st√¶rkt password
   - Gem password i en password manager!

3. **Konfigurer hjem**
   
   - Navngiv dit hjem
   - Angiv lokation (til solopgang/nedgang)
   - V√¶lg tidszone

4. **Opdater alt**
   
   G√• til **Settings** ‚Üí **System** ‚Üí **Updates** og installer alle opdateringer.
</Steps>

## üîß Fejlfinding

<Aside type="tip" title="VM starter ikke?">
**Tjek disse ting:**
1. Er BIOS sat til `OVMF (UEFI)`? HAOS kr√¶ver UEFI.
2. Er boot order korrekt? Skal v√¶re `scsi0` eller `virtio0`.
3. Har du nok RAM? Minimum 2GB, anbefalet 4GB.
4. Tjek Proxmox logs: `journalctl -u pve-manager`
</Aside>

<Aside type="tip" title="Ingen netv√¶rk?">
**Pr√∏v disse l√∏sninger:**
1. Tjek at bridge er korrekt (typisk `vmbr0`)
2. Tjek VLAN settings matcher dit netv√¶rk
3. Pr√∏v at genstarte VM
4. Tjek firewall regler p√• Proxmox
</Aside>

<Aside type="tip" title="USB enhed virker ikke?">
**Tjek:**
1. Er USB passthrough tilf√∏jet korrekt?
2. Genstart VM efter tilf√∏jelse af USB
3. Tjek `dmesg` i Proxmox for USB fejl
4. Pr√∏v en anden USB port p√• host
</Aside>

<Aside type="tip" title="Langsom performance?">
**Optimeringer:**
1. Brug `cache=writethrough` p√• disk
2. Brug `cpu: host` i stedet for `kvm64`
3. Aktiver `discard=on,ssd=1` p√• disk
4. √òg RAM til 4-8GB
</Aside>

## üîÑ Opdatering af HAOS

Home Assistant opdateres via web-interfacet:

1. **Settings** ‚Üí **System** ‚Üí **Updates**
2. Klik **Update** p√• tilg√¶ngelige opdateringer
3. Vent p√• genstart

<Aside type="danger" title="F√∏r opdatering">
Tag ALTID et snapshot f√∏r st√∏rre opdateringer:
```bash
qm snapshot VMID pre-upgrade-$(date +%Y%m%d) --vmstate 1
```
</Aside>

## üöÄ N√¶ste skridt

<CardGrid>
  <Card title="‚ö° F√∏rste automation" icon="rocket">
    Lav din f√∏rste automation i Home Assistant.
    
    [Lav automationer ‚Üí](/da/home-assistant/foerste-automation/)
  </Card>
  <Card title="üì° Zigbee2MQTT" icon="setting">
    Tilf√∏j Zigbee enheder med USB passthrough.
    
    [Ops√¶t Zigbee ‚Üí](/da/home-assistant/zigbee2mqtt/)
  </Card>
</CardGrid>
