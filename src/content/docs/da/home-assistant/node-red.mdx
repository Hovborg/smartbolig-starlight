---
title: Node-RED til Home Assistant
description: Komplet Node-RED guide - installation, Home Assistant integration, og avancerede automationer med visuel programmering.
sidebar:
  badge:
    text: Avanceret
    variant: caution
---

import { Card, CardGrid, Aside, Badge, Tabs, TabItem, Steps } from '@astrojs/starlight/components';
import FAQ from '../../../../components/FAQ.astro';

<Badge text="Node-RED" variant="danger" /> <Badge text="Automationer" variant="success" /> <Badge text="Avanceret" variant="caution" />

![Node-RED Automation](/images/guides/node-red-hero.png)

**Node-RED** er et visuelt programmeringsvÃ¦rktÃ¸j der gÃ¸r komplekse automationer overskuelige. TrÃ¦k nodes, forbind dem med linjer, og byg automationer der ville vÃ¦re umulige (eller meget besvÃ¦rlige) i Home Assistants standard automation editor.

---

## ğŸ¤” Hvorfor Node-RED?

### HA Automationer vs Node-RED

| Feature | HA Automationer | Node-RED |
|---------|-----------------|----------|
| **LÃ¦ringsurve** | Lav | Mellem-hÃ¸j |
| **Visuel editor** | Simpel | Avanceret |
| **Debugging** | BegrÃ¦nset | Fremragende |
| **Loops** | âŒ | âœ… |
| **Variabler** | BegrÃ¦nset | Flow/Global |
| **JavaScript** | âŒ | âœ… |
| **Genbrug (subflows)** | âŒ | âœ… |
| **Tidsbaseret logik** | Basis | Avanceret |

### HvornÃ¥r bruge Node-RED?

**Brug Node-RED nÃ¥r du har brug for:**
- Kompleks logik med mange betingelser
- Loops og gentagne handlinger
- Tilpasset JavaScript-kode
- Bedre debugging og fejlfinding
- Genanvendelige automationsblokke

**Bliv ved HA automationer nÃ¥r:**
- Automationen er simpel (trigger â†’ action)
- Du foretrÃ¦kker YAML/UI
- Du vil holde alt i Ã©t system

---

## ğŸ“¦ Installation

### Som Home Assistant Add-on

<Steps>
1. GÃ¥ til **Indstillinger â†’ Add-ons**

2. Klik **Add-on Store** (nederst til hÃ¸jre)

3. SÃ¸g efter "Node-RED"

4. VÃ¦lg **Node-RED** og klik **Installer**

5. Konfigurer add-on:
   ```yaml
   # Vigtige indstillinger:
   ssl: false  # SÃ¦t til true hvis du har SSL
   credential_secret: "din-hemmelige-nÃ¸gle"
   ```

6. Start add-on og aktiver:
   - âœ… Start on boot
   - âœ… Watchdog
   - âœ… Show in sidebar

7. Ã…bn Node-RED via sidebaren
</Steps>

### Docker Installation

```yaml
# docker-compose.yml
version: '3'
services:
  nodered:
    image: nodered/node-red:latest
    container_name: nodered
    restart: unless-stopped
    ports:
      - "1880:1880"
    volumes:
      - ./nodered-data:/data
    environment:
      - TZ=Europe/Copenhagen
```

---

## ğŸ”— Home Assistant Integration

### Opret Access Token

<Steps>
1. I Home Assistant, klik pÃ¥ dit **profilbillede** (nederst til venstre)

2. Scroll ned til **Langvarige adgangstokens**

3. Klik **Opret token**

4. Navngiv den "Node-RED"

5. **Kopier tokenet** - du kan kun se det Ã©n gang!
</Steps>

### Konfigurer Server i Node-RED

<Steps>
1. TrÃ¦k en **events: state** node ind pÃ¥ workspace

2. Dobbeltklik og klik pÃ¥ **blyanten** ved siden af Server

3. Udfyld:
   ```
   Name: Home Assistant
   Base URL: http://homeassistant.local:8123
   Access Token: [din token fra forrige trin]
   ```

4. Klik **Add** og derefter **Done**
</Steps>

### Installer Companion Integration (Valgfri)

For ekstra funktioner som at aktivere/deaktivere flows fra HA:

<Steps>
1. Installer via HACS:
   - SÃ¸g "Node-RED Companion"
   - Installer og genstart HA

2. TilfÃ¸j integration:
   - Indstillinger â†’ Enheder & Tjenester â†’ TilfÃ¸j Integration
   - SÃ¸g "Node-RED"
</Steps>

---

## ğŸ§± Node-RED Basics

### Terminologi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLOW (Tab)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              SEQUENCE (Forbundne nodes)              â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚   â”‚ NODE â”‚â”€â”€â”€â–ºâ”‚ NODE â”‚â”€â”€â”€â–ºâ”‚ NODE â”‚â”€â”€â”€â–ºâ”‚ NODE â”‚     â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚        msg.payload sendes mellem nodes              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ANDEN SEQUENCE                          â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”                              â”‚   â”‚
â”‚  â”‚   â”‚ NODE â”‚â”€â”€â”€â–ºâ”‚ NODE â”‚                              â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Term | Beskrivelse |
|------|-------------|
| **Node** | En enkelt byggeklods (trigger, action, logik) |
| **Sequence** | Forbundne nodes der udgÃ¸r Ã©n automation |
| **Flow** | Alle sequences pÃ¥ Ã©n tab |
| **msg** | Besked der sendes mellem nodes |
| **msg.payload** | Standard data-felt i beskeden |

### Variable Scopes

| Scope | TilgÃ¦ngelig | Brug |
|-------|-------------|------|
| **msg** | Kun i nuvÃ¦rende sequence | Data mellem nodes |
| **flow** | Alle nodes pÃ¥ samme tab | Delt data pÃ¥ flow |
| **global** | Alle nodes overalt | Delt data pÃ¥ tvÃ¦rs |

```javascript
// SÃ¦t variabler
flow.set("myVar", "vÃ¦rdi");
global.set("globalVar", 123);

// LÃ¦s variabler
let x = flow.get("myVar");
let y = global.get("globalVar");
```

---

## ğŸ  Home Assistant Nodes

### De Vigtigste Nodes

| Node | Funktion | Brug |
|------|----------|------|
| **events: state** | Trigger ved tilstandsÃ¦ndring | Start automationer |
| **current state** | LÃ¦s aktuel tilstand | Betingelser |
| **call service** | Kald HA service | Handlinger |
| **wait until** | Vent pÃ¥ tilstand | Forsinkelser med betingelse |
| **trigger: state** | Trigger med flere betingelser | Avancerede triggers |
| **api** | Generel API-adgang | Alt muligt |

### Eksempel pÃ¥ Node-RED Flow

![Node-RED flow eksempel](/images/guides/node-red/flow.svg)

### events: state Node

Trigger nÃ¥r en entity Ã¦ndrer tilstand:

```yaml
# Konfiguration:
Entity: light.stue
If State: "on"          # Valgfri: Kun trigger ved denne tilstand
For: 00:00:05           # Valgfri: Kun hvis tilstand holder i 5 sek
```

Output:
```javascript
msg.payload = "on";           // Ny tilstand
msg.data.old_state.state      // Gammel tilstand
msg.data.entity_id            // Entity ID
```

### current state Node

LÃ¦s tilstand midt i et flow (trigger ikke selv):

```yaml
# Konfiguration:
Entity: binary_sensor.motion_kitchen
If State: "on"
# Hvis tilstand matcher â†’ Output 1
# Hvis ikke â†’ Output 2 (eller stop)
```

### call service Node

UdfÃ¸r handlinger i Home Assistant:

```yaml
# Eksempel: TÃ¦nd lys
Domain: light
Service: turn_on
Entity: light.stue
Data: {"brightness": 255, "color_temp": 350}
```

---

## ğŸ“ Praktiske Eksempler

### Eksempel 1: Simpel BevÃ¦gelsesbelysning

```
[events: state]â”€â”€â–º[call service]
   motion_sensor      light.turn_on

[events: state]â”€â”€â–º[delay]â”€â”€â–º[call service]
   motion_sensor    2 min     light.turn_off
   (off)
```

**Flow JSON:**
```json
[
  {
    "id": "motion_on",
    "type": "server-state-changed",
    "entity_id": "binary_sensor.motion_stue",
    "ifstate": "on",
    "wires": [["light_on"]]
  },
  {
    "id": "light_on",
    "type": "api-call-service",
    "domain": "light",
    "service": "turn_on",
    "entity_id": "light.stue"
  }
]
```

### Eksempel 2: Betinget Automation (Kun om natten)

```
[events: state]â”€â”€â–º[current state]â”€â”€â–º[call service]
   motion            sun.sun          light.turn_on
                     (below_horizon)
```

Sun entity bruges til at tjekke om det er nat fÃ¸r lyset tÃ¦ndes.

### Eksempel 3: Timeout med Reset

Lys der slukker efter 5 minutter uden bevÃ¦gelse, men resetter hvis der er ny bevÃ¦gelse:

```
[events: state]â”€â”€â–º[stoptimer]â”€â”€â–º[call service]
   motion (on)      reset          (ingenting)
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[stoptimer]â”€â”€â–º[call service]
                    start 5min     light.turn_off
```

<Aside type="tip" title="Installer stoptimer">
`node-red-contrib-stoptimer` installeres via:
Menu â†’ Manage palette â†’ Install â†’ SÃ¸g "stoptimer"
</Aside>

### Eksempel 4: Multi-Room Presence

TÃ¦nd/sluk lys baseret pÃ¥ hvilke rum der er bevÃ¦gelse i:

```javascript
// Function node til at tracke aktive rum
let activeRooms = global.get("activeRooms") || [];
let room = msg.data.entity_id.replace("binary_sensor.motion_", "");

if (msg.payload === "on") {
    if (!activeRooms.includes(room)) {
        activeRooms.push(room);
    }
} else {
    activeRooms = activeRooms.filter(r => r !== room);
}

global.set("activeRooms", activeRooms);
msg.activeRooms = activeRooms;
return msg;
```

---

## ğŸ”§ Avancerede Teknikker

### Subflows (Genanvendelig Logik)

Lav dine egne nodes fra en gruppe af nodes:

<Steps>
1. VÃ¦lg de nodes du vil genbruge

2. **Menu â†’ Subflows â†’ Selection to Subflow**

3. Navngiv din subflow

4. Den nye subflow vises i paletten under "subflows"

5. TrÃ¦k den ind hvor du har brug for den
</Steps>

### Link Nodes

Forbind sequences pÃ¥ tvÃ¦rs af flows uden at trÃ¦kke lange linjer:

```
Flow 1:                           Flow 2:
[trigger]â”€â”€â–º[link out: "alarm"]   [link in: "alarm"]â”€â”€â–º[action]
```

### Inject Node til Test

Test dine flows uden at vente pÃ¥ rigtige triggers:

```
[inject]â”€â”€â–º[resten af dit flow]
  (manuel trigger via klik)
```

Konfigurer inject node med testdata:
```javascript
msg.payload = "on";
msg.data = {
    entity_id: "binary_sensor.test",
    old_state: { state: "off" }
};
```

### Debug Node

Se hvad der sker i dit flow:

```
[trigger]â”€â”€â–º[debug]â”€â”€â–º[action]
              â”‚
              â””â”€â”€â–º Viser msg i Debug panel
```

Tip: SÃ¦t debug til "complete msg object" for at se alt.

---

## ğŸ“š Nyttige Paletter

Installer via **Menu â†’ Manage palette â†’ Install**:

| Palette | Beskrivelse |
|---------|-------------|
| **node-red-contrib-bigtimer** | Avanceret tidsbaseret scheduling |
| **node-red-contrib-stoptimer** | Start/stop/reset timers |
| **node-red-contrib-weekday** | Filter pÃ¥ ugedage |
| **node-red-contrib-time-range-switch** | Routing baseret pÃ¥ tid |
| **node-red-contrib-schedex** | Solnedgang/solopgang scheduling |
| **node-red-dashboard** | Byg dashboards i Node-RED |

---

## ğŸ› Fejlfinding

### Flow Deployer Ikke

```yaml
# Tjek:
1. Alle nodes har gyldige forbindelser
2. Ingen rÃ¸de trekanter pÃ¥ nodes (konfigurationsfejl)
3. Server connection er konfigureret
4. Access token er gyldig
```

### Automation Trigger Ikke

<Steps>
1. TilfÃ¸j **debug node** efter trigger

2. Tjek at entity_id er korrekt

3. Verificer at "If State" matcher

4. Tjek Debug panel for output
</Steps>

### Forbindelse til HA Fejler

```yaml
# Tjek access token:
1. Opret ny token i HA
2. Opdater server config i Node-RED
3. Deploy alle flows
4. Genstart Node-RED add-on
```

---

## ğŸ“‹ Best Practices

### Organisering

| Praksis | Beskrivelse |
|---------|-------------|
| **Ã‰n tab per omrÃ¥de** | Stue, kÃ¸kken, sovevÃ¦relse, etc. |
| **Kommentarer** | Brug comment nodes til forklaring |
| **Navngivning** | Giv alle nodes beskrivende navne |
| **Subflows** | Genbrug logik frem for copy/paste |

### Performance

```yaml
# UndgÃ¥:
- events: all node (bruger mange ressourcer)
- Polling i loops (brug triggers i stedet)
- Store debug outputs i produktion

# Brug:
- "Modified Flows" deploy type
- Specifikke entity triggers
- Disable debug nodes nÃ¥r ikke i brug
```

### Backup

Node-RED flows gemmes i:
```
# Add-on:
/config/node-red/flows.json

# Docker:
./nodered-data/flows.json
```

Inkluder denne fil i din Home Assistant backup!

---

## â“ Ofte Stillede SpÃ¸rgsmÃ¥l

<FAQ questions={[
  {
    question: "Skal jeg flytte alle mine automationer til Node-RED?",
    answer: "Nej! Brug Node-RED til komplekse automationer og behold simple automationer i HA. Der er ingen grund til at gÃ¸re tingene mere komplicerede end nÃ¸dvendigt."
  },
  {
    question: "Kan Node-RED kÃ¸re uden Home Assistant?",
    answer: "Ja, Node-RED er et selvstÃ¦ndigt vÃ¦rktÃ¸j. Du kan bruge det til andre IoT-projekter, API-integrationer, og meget mere. HA-noderne er bare et ekstra modul."
  },
  {
    question: "Hvad sker der med mine automationer hvis Node-RED gÃ¥r ned?",
    answer: "Automationer i Node-RED stopper. Derfor er det vigtigt at holde kritiske automationer (alarm, sikkerhed) i Home Assistant selv, eller have watchdog aktiveret pÃ¥ Node-RED."
  },
  {
    question: "Kan jeg se Node-RED automationer i HA's automations liste?",
    answer: "Ikke direkte. Med Node-RED Companion integration kan du dog se og aktivere/deaktivere flows fra HA's UI."
  }
]} />

---

## ğŸ“š NÃ¦ste Trin

<CardGrid>
  <Card title="HA Dashboard Design" icon="laptop">
    Byg smukke dashboards.
    
    [Se guide â†’](/da/home-assistant/dashboard-design/)
  </Card>
  <Card title="FÃ¸rste Automation" icon="rocket">
    Start med HA's built-in automationer.
    
    [Se guide â†’](/da/home-assistant/foerste-automation/)
  </Card>
</CardGrid>

---

*Sidst opdateret: December 2025*
